description: >
  This jobs builds docker image.
  Exposed environment variables can be used in extra-build-args interpolation.
  Exposed environment variables: IMAGE_NAME

parameters:
  image-name:
    type: string
    description: docker image name

  extra-build-args:
    type: string
    description: Extra flags to pass to docker build
    default: ""

shell: /bin/bash --login -eo pipefail

executor: python-node

working_directory: ~/app

environment:
  IMAGE_NAME: <<parameters.image-name>>

steps:
  - checkout
  - setup_remote_docker:
      version: 19.03.13
      docker_layer_caching: true
  - aws-cli/install
  - aws-ecr/ecr-login
  - docker/check
  - docker/build:
      image: << parameters.image-name >>
      extra_build_args: << parameters.extra-build-args >>
